// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.28.0
// source: chats.sql

package gen

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createChat = `-- name: CreateChat :one
insert into chats (
    name,
    dataset_id,
    created_by
) values ($1, $2, $3)
returning id, name, dataset_id, created_at, updated_at, created_by
`

type CreateChatParams struct {
	Name      string
	DatasetID pgtype.UUID
	CreatedBy pgtype.Text
}

// Chat Operations
func (q *Queries) CreateChat(ctx context.Context, arg CreateChatParams) (Chat, error) {
	row := q.db.QueryRow(ctx, createChat, arg.Name, arg.DatasetID, arg.CreatedBy)
	var i Chat
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.DatasetID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.CreatedBy,
	)
	return i, err
}

const createChatMessage = `-- name: CreateChatMessage :one
insert into chat_messages (
    chat_id,
    content,
    role,
    created_at
) values ($1, $2, $3, $4)
returning id, chat_id, content, role, created_at
`

type CreateChatMessageParams struct {
	ChatID    pgtype.UUID
	Content   string
	Role      string
	CreatedAt pgtype.Timestamptz
}

// Chat Messages Operations
func (q *Queries) CreateChatMessage(ctx context.Context, arg CreateChatMessageParams) (ChatMessage, error) {
	row := q.db.QueryRow(ctx, createChatMessage,
		arg.ChatID,
		arg.Content,
		arg.Role,
		arg.CreatedAt,
	)
	var i ChatMessage
	err := row.Scan(
		&i.ID,
		&i.ChatID,
		&i.Content,
		&i.Role,
		&i.CreatedAt,
	)
	return i, err
}

const deleteChat = `-- name: DeleteChat :exec
delete from chats where id = $1
`

func (q *Queries) DeleteChat(ctx context.Context, id pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deleteChat, id)
	return err
}

const deleteChatMessage = `-- name: DeleteChatMessage :exec
delete from chat_messages 
where id = $1 and chat_id = $2
`

type DeleteChatMessageParams struct {
	ID     pgtype.UUID
	ChatID pgtype.UUID
}

func (q *Queries) DeleteChatMessage(ctx context.Context, arg DeleteChatMessageParams) error {
	_, err := q.db.Exec(ctx, deleteChatMessage, arg.ID, arg.ChatID)
	return err
}

const getChat = `-- name: GetChat :one
select 
    c.id, c.name, c.dataset_id, c.created_at, c.updated_at, c.created_by,
    d.name as dataset_name,
    (select count(*) from chat_messages where chat_id = c.id) as message_count
from chats c
join datasets d on c.dataset_id = d.id
where c.id = $1
`

type GetChatRow struct {
	ID           pgtype.UUID
	Name         string
	DatasetID    pgtype.UUID
	CreatedAt    pgtype.Timestamptz
	UpdatedAt    pgtype.Timestamptz
	CreatedBy    pgtype.Text
	DatasetName  string
	MessageCount int64
}

func (q *Queries) GetChat(ctx context.Context, id pgtype.UUID) (GetChatRow, error) {
	row := q.db.QueryRow(ctx, getChat, id)
	var i GetChatRow
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.DatasetID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.CreatedBy,
		&i.DatasetName,
		&i.MessageCount,
	)
	return i, err
}

const getChatMessagesCount = `-- name: GetChatMessagesCount :one
select count(*) 
from chat_messages
where chat_id = $1
`

func (q *Queries) GetChatMessagesCount(ctx context.Context, chatID pgtype.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, getChatMessagesCount, chatID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const getDatasetChatsCount = `-- name: GetDatasetChatsCount :one
select count(*) 
from chats
where dataset_id = $1
`

func (q *Queries) GetDatasetChatsCount(ctx context.Context, datasetID pgtype.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, getDatasetChatsCount, datasetID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const getUserChatsCount = `-- name: GetUserChatsCount :one
select count(*) 
from chats
where created_by = $1
`

func (q *Queries) GetUserChatsCount(ctx context.Context, createdBy pgtype.Text) (int64, error) {
	row := q.db.QueryRow(ctx, getUserChatsCount, createdBy)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const listChatMessages = `-- name: ListChatMessages :many
select id, chat_id, content, role, created_at from chat_messages
where chat_id = $1
order by created_at asc
limit $2 offset $3
`

type ListChatMessagesParams struct {
	ChatID pgtype.UUID
	Limit  int32
	Offset int32
}

func (q *Queries) ListChatMessages(ctx context.Context, arg ListChatMessagesParams) ([]ChatMessage, error) {
	rows, err := q.db.Query(ctx, listChatMessages, arg.ChatID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ChatMessage
	for rows.Next() {
		var i ChatMessage
		if err := rows.Scan(
			&i.ID,
			&i.ChatID,
			&i.Content,
			&i.Role,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listDatasetChats = `-- name: ListDatasetChats :many
select 
    c.id, c.name, c.dataset_id, c.created_at, c.updated_at, c.created_by,
    (select count(*) from chat_messages where chat_id = c.id) as message_count
from chats c
where c.dataset_id = $1
order by c.updated_at desc
limit $2 offset $3
`

type ListDatasetChatsParams struct {
	DatasetID pgtype.UUID
	Limit     int32
	Offset    int32
}

type ListDatasetChatsRow struct {
	ID           pgtype.UUID
	Name         string
	DatasetID    pgtype.UUID
	CreatedAt    pgtype.Timestamptz
	UpdatedAt    pgtype.Timestamptz
	CreatedBy    pgtype.Text
	MessageCount int64
}

func (q *Queries) ListDatasetChats(ctx context.Context, arg ListDatasetChatsParams) ([]ListDatasetChatsRow, error) {
	rows, err := q.db.Query(ctx, listDatasetChats, arg.DatasetID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListDatasetChatsRow
	for rows.Next() {
		var i ListDatasetChatsRow
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.DatasetID,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.CreatedBy,
			&i.MessageCount,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listUserChats = `-- name: ListUserChats :many
select 
    c.id, c.name, c.dataset_id, c.created_at, c.updated_at, c.created_by,
    d.name as dataset_name,
    (select count(*) from chat_messages where chat_id = c.id) as message_count
from chats c
join datasets d on c.dataset_id = d.id
where c.created_by = $1
order by c.updated_at desc
limit $2 offset $3
`

type ListUserChatsParams struct {
	CreatedBy pgtype.Text
	Limit     int32
	Offset    int32
}

type ListUserChatsRow struct {
	ID           pgtype.UUID
	Name         string
	DatasetID    pgtype.UUID
	CreatedAt    pgtype.Timestamptz
	UpdatedAt    pgtype.Timestamptz
	CreatedBy    pgtype.Text
	DatasetName  string
	MessageCount int64
}

func (q *Queries) ListUserChats(ctx context.Context, arg ListUserChatsParams) ([]ListUserChatsRow, error) {
	rows, err := q.db.Query(ctx, listUserChats, arg.CreatedBy, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListUserChatsRow
	for rows.Next() {
		var i ListUserChatsRow
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.DatasetID,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.CreatedBy,
			&i.DatasetName,
			&i.MessageCount,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateChat = `-- name: UpdateChat :one
update chats
set 
    name = coalesce($1, name)
where id = $2
returning id, name, dataset_id, created_at, updated_at, created_by
`

type UpdateChatParams struct {
	Name string
	ID   pgtype.UUID
}

func (q *Queries) UpdateChat(ctx context.Context, arg UpdateChatParams) (Chat, error) {
	row := q.db.QueryRow(ctx, updateChat, arg.Name, arg.ID)
	var i Chat
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.DatasetID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.CreatedBy,
	)
	return i, err
}
